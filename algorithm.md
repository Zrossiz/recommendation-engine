## Логика работы алгоритма

### 1. Получение категорий пользователя

- Извлекаем все категории, с которыми взаимодействовал пользователь, из таблицы `user_interactions`.
- Учитываются последние **100 единиц просмотренного контента**, где процент просмотра видео был **более 40%**.

### 2. Начисление баллов для каждой категории

#### Введение бальной системы

Для каждой категории контента рассчитывается количество баллов на основе следующих факторов:

- **Время просмотра**: Баллы рассчитываются по формуле:
  x = (процент просмотра / 100)^2 * 10  

- **Взаимодействие**:
  - Просмотр — **1 балл**
  - Комментарий — **2 балла**
  - Лайк — **3 балла**
  - Сохранение — **4 балла**
  - Репост на страницу — **5 баллов**
  - Дизлайк — **-100 баллов**

- **Особые условия**:
  - Если категория контента находится у пользователя в «интересных», добавляется **+10 баллов** к текущей сумме баллов категории.
  - Если более **50%** контента относится к одной категории, то на эту категорию накладывается **дебафф -30%** от текущего количества баллов.

### 3. Сортировка категорий и расчет процента для каждой категории

1. После начисления баллов категории сортируются по количеству баллов.
2. Общая сумма баллов используется для расчета процента для каждой категории:
   - Например, если категория имеет 10 баллов из 100, то **10%** рекомендованного контента должно относиться к этой категории.

### 4. Добавление разнообразия

Для поддержания разнообразия ленты:

- Добавляется **по 1 видео из 2 незнакомых категорий**.
- Добавляется **1 популярное видео**, не соответствующих предпочтениям пользователя, из таблицы `trending_content` (обновляется каждые **12 часов**).

### 5. Пересчет интересов пользователя

- Раз в **40 просмотренных видео** запускается алгоритм пересчета интересов пользователя.
- Автоматически выделяются **3 основные интереса** на основе последних взаимодействий.

### 6. Количество контента на один запрос

На каждый запрос система возвращает **20 единиц контента**.
